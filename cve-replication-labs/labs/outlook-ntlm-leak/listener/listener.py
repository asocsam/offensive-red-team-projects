from __future__ import annotations

import logging
from pathlib import Path

from impacket.examples.smbserver import SimpleSMBServer


ARTIFACT_DIR = Path("/artifacts")
ARTIFACT_DIR.mkdir(parents=True, exist_ok=True)

logging.basicConfig(level=logging.INFO, format="[%(levelname)s] %(message)s")


def main() -> None:
    server = SimpleSMBServer(listenAddress="0.0.0.0", listenPort=445)
    server.addShare("share", str(ARTIFACT_DIR), comment="Capture share")
    server.setSMB2Support(True)
    logging.info("NTLM capture listener started on \\%s\\share", "ntlm-listener")
    try:
        server.start()
    except KeyboardInterrupt:
        logging.info("Shutting down listener")


if __name__ == "__main__":
    main()
