# OpenSSH RCE Lab (CVE-2023-38408)

This lab reproduces the PKCS#11 exploitation path fixed in OpenSSH 9.3.  A
vulnerable OpenSSH 9.2 server is deployed alongside an attacker workstation that
builds a malicious PKCS#11 shared object for use with agent forwarding.

## Components

- **server** – Debian Bookworm container with OpenSSH 9.2 configured for verbose
  logging and agent forwarding.
- **attacker** – Builder environment that compiles `libpwn.so` demonstrating
  arbitrary code execution when loaded as a PKCS#11 provider.

## Usage

```bash
python ../../lab_manager.py prepare openssh-rce --dry-run   # inspect commands
python ../../lab_manager.py prepare openssh-rce              # build containers
```

After the attacker container starts it compiles `/payloads/libpwn.so` and waits.
From the attacker container (or host) run:

```bash
docker exec -it openssh-attacker bash
ssh lab@openssh-server-lab -p 22  # password lab123 to establish trust
ssh -F /dev/null \
  -o 'ForwardAgent=yes' \
  -o 'PKCS11Provider=/payloads/libpwn.so' \
  lab@openssh-server-lab -p 22
```

During the second SSH session the malicious library executes, writing to
`/payloads/pwned.txt` and printing a banner to stderr.  Inspect the file from the
host to verify exploitation.

Shut down the lab when complete:

```bash
python ../../lab_manager.py destroy openssh-rce
```

## Safety Notes

- The provided payload is benign and only writes to a shared volume.
- Use isolated networks; never expose the vulnerable server publicly.
